(()=>{"use strict";var e,t={10:(e,t,n)=>{var s=n(228),o=n(265),r=n(6);class i{constructor(){this.logger=new o.Vy("Popup"),this.currentTab=null,this.currentScrapeResult=null,this.init()}async init(){this.logger.info("Initializing popup");try{await this.getCurrentTab(),this.setupEventListeners(),await this.checkPageStatus(),await this.loadRecentScrapes(),this.logger.info("Popup initialized successfully")}catch(e){this.logger.error("Failed to initialize popup:",e),this.showError("Failed to initialize extension")}}async getCurrentTab(){const e=await chrome.tabs.query({active:!0,currentWindow:!0});if(this.currentTab=e[0]||null,!this.currentTab)throw new Error("No active tab found");this.logger.debug("Current tab:",this.currentTab.url)}setupEventListeners(){const e=document.getElementById("scrapeBtn");e?.addEventListener("click",()=>this.handleScrape());const t=document.getElementById("facebookBtn");t?.addEventListener("click",()=>this.handleFacebookAutofill());const n=document.getElementById("downloadBtn");n?.addEventListener("click",()=>this.handleDownloadPhotos());const s=document.getElementById("fullAppBtn");s?.addEventListener("click",()=>this.openFullApp());const o=document.getElementById("settingsBtn");o?.addEventListener("click",()=>this.openSettings()),this.logger.debug("Event listeners setup complete")}async checkPageStatus(){if(this.currentTab?.url)try{const e=["autotrader.com","cars.com","cargurus.com","dealer.com"],t=new URL(this.currentTab.url).hostname;if(e.some(e=>t.includes(e))){const e=await chrome.tabs.sendMessage(this.currentTab.id,{type:"CHECK_VEHICLE_PAGE"});e?.isVehiclePage?(this.updateStatus("âœ…","Vehicle page detected","Ready to scrape"),this.enableScraping()):this.updateStatus("âš ï¸","Not a vehicle page","Navigate to a vehicle detail page")}else this.updateStatus("ðŸ”","Unknown site","Will use generic scraping"),this.enableScraping()}catch(e){this.logger.warn("Could not check page status:",e),this.updateStatus("ðŸ”","Page check failed","Generic scraping available"),this.enableScraping()}else this.updateStatus("âŒ","No page loaded","Please navigate to a vehicle page")}updateStatus(e,t,n){const s=document.getElementById("pageStatus"),o=s?.querySelector(".status-icon"),r=s?.querySelector(".status-title"),i=s?.querySelector(".status-subtitle");o&&(o.textContent=e),r&&(r.textContent=t),i&&(i.textContent=n)}enableScraping(){const e=document.getElementById("scrapeBtn");e&&(e.disabled=!1)}async handleScrape(){if(this.currentTab?.id){this.showLoading(!0),this.logger.info("Starting scrape operation");try{const e=await chrome.runtime.sendMessage({type:"SCRAPE_PAGE"});if(e.error)throw new Error(e.error);this.currentScrapeResult=e.result,this.currentScrapeResult&&this.displayScrapeResults(this.currentScrapeResult),this.showPostScrapeActions(),o.JV.show("Vehicle data scraped successfully!","success"),this.logger.info("Scrape completed successfully")}catch(e){this.logger.error("Scrape failed:",e),this.showError("Failed to scrape page: "+e.message)}finally{this.showLoading(!1)}}else this.showError("No active tab")}displayScrapeResults(e){const t=document.getElementById("scrapeResults"),n=document.getElementById("vehicleTitle"),s=document.getElementById("vehiclePrice"),o=document.getElementById("vehicleMileage"),i=document.getElementById("photoCount"),a=document.getElementById("photoPreview");if(t){if(t.classList.remove("hidden"),n&&(n.textContent=(0,r.WW)(e.vehicle)||"Unknown Vehicle"),s&&(s.textContent=e.vehicle.price?(0,r.$g)(e.vehicle.price):"Price N/A"),o&&(o.textContent=e.vehicle.mileage?(0,r.M6)(e.vehicle.mileage):"Mileage N/A"),i){const t=e.photos.length;i.textContent=`${t} photo${1!==t?"s":""}`}if(a&&(a.innerHTML="",e.photos.length>0)){const t=Math.min(3,e.photos.length);for(let n=0;n<t;n++){const t=document.createElement("img");t.src=e.photos[n].url,t.className="photo-thumb",t.onerror=()=>{t.style.display="none"},a.appendChild(t)}if(e.photos.length>3){const t=document.createElement("div");t.className="photo-more",t.textContent="+"+(e.photos.length-3),a.appendChild(t)}}this.displayWarnings(e.warnings)}}displayWarnings(e){const t=document.getElementById("warnings"),n=document.getElementById("warningsList");t&&n&&(e.length>0?(t.classList.remove("hidden"),n.innerHTML="",e.forEach(e=>{const t=document.createElement("li");t.textContent=e,n.appendChild(t)})):t.classList.add("hidden"))}showPostScrapeActions(){const e=document.getElementById("postScrapeActions");e&&e.classList.remove("hidden")}async handleFacebookAutofill(){if(this.currentScrapeResult){this.showLoading(!0),this.logger.info("Starting Facebook autofill");try{const e=await chrome.runtime.sendMessage({type:"OPEN_FACEBOOK_MARKETPLACE",scrapeResult:this.currentScrapeResult});if(e.error)throw new Error(e.error);o.JV.show("Facebook Marketplace opened! Autofill starting...","info"),this.logger.info("Facebook autofill initiated"),setTimeout(()=>window.close(),1e3)}catch(e){this.logger.error("Facebook autofill failed:",e),this.showError("Failed to open Facebook: "+e.message)}finally{this.showLoading(!1)}}else this.showError("No scrape data available")}async handleDownloadPhotos(){if(this.currentScrapeResult?.photos.length){this.showLoading(!0),this.logger.info("Starting photo download");try{const e=this.currentScrapeResult.photos.map(e=>e.url),t=await chrome.runtime.sendMessage({type:"DOWNLOAD_PHOTOS",photos:e});if(t.error)throw new Error(t.error);o.JV.show(`Downloaded ${t.count} photos`,"success"),this.logger.info(`Downloaded ${t.count} photos`)}catch(e){this.logger.error("Photo download failed:",e),this.showError("Failed to download photos: "+e.message)}finally{this.showLoading(!1)}}else this.showError("No photos to download")}openFullApp(){chrome.tabs.create({url:chrome.runtime.getURL("src/ui/options.html")}),window.close()}openSettings(){chrome.tabs.create({url:chrome.runtime.getURL("src/ui/options.html#settings")}),window.close()}async loadRecentScrapes(){try{const e=(await s.I.getScrapeResults()).slice(0,5),t=document.getElementById("recentList");if(!t)return;if(0===e.length)return void(t.innerHTML='\n          <div class="empty-state">\n            <div class="empty-icon">ðŸ“­</div>\n            <div class="empty-text">No recent scrapes</div>\n          </div>\n        ');t.innerHTML="",e.forEach(e=>{const n=this.createRecentItem(e);t.appendChild(n)})}catch(e){this.logger.error("Failed to load recent scrapes:",e)}}createRecentItem(e){const t=document.createElement("div");t.className="recent-item";const n=(0,r.WW)(e.vehicle)||"Unknown Vehicle",s=e.vehicle.price?(0,r.$g)(e.vehicle.price):"N/A",o=new Date(e.scrapedAt).toLocaleDateString(),i=new URL(e.sourceUrl).hostname;t.innerHTML=`\n      <div class="recent-info">\n        <div class="recent-title">${n}</div>\n        <div class="recent-details">\n          <span class="recent-price">${s}</span>\n          <span class="recent-site">${i}</span>\n          <span class="recent-date">${o}</span>\n        </div>\n      </div>\n      <button class="recent-action" data-id="${e.id}">\n        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n          <path d="M9 12l2 2 4-4"></path>\n          <path d="M21 12c-1 0-3-1-3-3s2-3 3-3 3 1 3 3-2 3-3 3"></path>\n          <path d="M3 12c1 0 3-1 3-3s-2-3-3-3-3 1-3 3 2 3 3 3"></path>\n        </svg>\n      </button>\n    `;const a=t.querySelector(".recent-action");return a?.addEventListener("click",t=>{t.stopPropagation(),this.handleRecentItemAction(e)}),t}async handleRecentItemAction(e){this.currentScrapeResult=e,this.displayScrapeResults(e),this.showPostScrapeActions(),o.JV.show("Previous scrape data loaded","info")}showLoading(e){const t=document.getElementById("loadingOverlay");t&&(e?t.classList.remove("hidden"):t.classList.add("hidden"))}showError(e){o.JV.show(e,"error")}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>new i):new i}},n={};function s(e){var o=n[e];if(void 0!==o)return o.exports;var r=n[e]={exports:{}};return t[e](r,r.exports,s),r.exports}s.m=t,e=[],s.O=(t,n,o,r)=>{if(!n){var i=1/0;for(h=0;h<e.length;h++){for(var[n,o,r]=e[h],a=!0,c=0;c<n.length;c++)(!1&r||i>=r)&&Object.keys(s.O).every(e=>s.O[e](n[c]))?n.splice(c--,1):(a=!1,r<i&&(i=r));if(a){e.splice(h--,1);var l=o();void 0!==l&&(t=l)}}return t}r=r||0;for(var h=e.length;h>0&&e[h-1][2]>r;h--)e[h]=e[h-1];e[h]=[n,o,r]},s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={887:0};s.O.j=t=>0===e[t];var t=(t,n)=>{var o,r,[i,a,c]=n,l=0;if(i.some(t=>0!==e[t])){for(o in a)s.o(a,o)&&(s.m[o]=a[o]);if(c)var h=c(s)}for(t&&t(n);l<i.length;l++)r=i[l],s.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return s.O(h)},n=self.webpackChunkworkspace=self.webpackChunkworkspace||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var o=s.O(void 0,[76],()=>s(10));o=s.O(o)})();
//# sourceMappingURL=popup.js.map