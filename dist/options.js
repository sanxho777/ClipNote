(()=>{"use strict";var e,t={678:(e,t,n)=>{var i=n(228),s=n(265),o=n(6);class a{constructor(){this.logger=new s.Vy("Options"),this.currentData=null,this.filteredResults=[],this.currentSection="inventory",this.init()}async init(){this.logger.info("Initializing options page");try{this.setupNavigation(),this.setupEventListeners(),await this.loadData(),this.showSection("inventory"),this.logger.info("Options page initialized successfully")}catch(e){this.logger.error("Failed to initialize options page:",e),this.showError("Failed to initialize application")}}setupNavigation(){document.querySelectorAll(".nav-link").forEach(e=>{e.addEventListener("click",e=>{e.preventDefault();const t=e.currentTarget.dataset.section;t&&this.showSection(t)})})}setupEventListeners(){const e=document.getElementById("searchInput"),t=document.getElementById("searchBtn"),n=document.getElementById("makeFilter"),i=document.getElementById("yearFilter"),s=document.getElementById("priceFilter"),o=document.getElementById("clearFilters");e?.addEventListener("input",()=>this.applyFilters()),t?.addEventListener("click",()=>this.applyFilters()),n?.addEventListener("change",()=>this.applyFilters()),i?.addEventListener("change",()=>this.applyFilters()),s?.addEventListener("change",()=>this.applyFilters()),o?.addEventListener("click",()=>this.clearFilters());const a=document.getElementById("exportBtn"),l=document.getElementById("importBtn"),r=document.getElementById("clearBtn");a?.addEventListener("click",()=>this.exportData()),l?.addEventListener("click",()=>this.importData()),r?.addEventListener("click",()=>this.clearAllData());const c=document.getElementById("saveSettings"),d=document.getElementById("resetSettings");c?.addEventListener("click",()=>this.saveSettings()),d?.addEventListener("click",()=>this.resetSettings());const h=document.querySelector(".modal-close"),u=document.getElementById("vehicleModal");h?.addEventListener("click",()=>this.closeModal()),u?.addEventListener("click",e=>{e.target===u&&this.closeModal()});const m=document.getElementById("importFileInput");m?.addEventListener("change",e=>this.handleFileImport(e)),this.logger.debug("Event listeners setup complete")}showSection(e){this.currentSection=e,this.logger.debug(`Showing section: ${this.currentSection}`),document.querySelectorAll(".nav-link").forEach(e=>{e.classList.remove("active")}),document.querySelector(`[data-section="${e}"]`)?.classList.add("active"),document.querySelectorAll(".content-section").forEach(e=>{e.classList.add("hidden")});const t=document.getElementById(`${e}Section`);switch(t?.classList.remove("hidden"),this.updateSectionHeader(e),e){case"inventory":this.updateInventoryView();break;case"analytics":this.updateAnalyticsView();break;case"settings":this.updateSettingsView()}}updateSectionHeader(e){const t=document.getElementById("sectionTitle"),n=document.getElementById("sectionSubtitle"),i={inventory:{title:"Inventory",subtitle:"Manage your scraped vehicle data"},analytics:{title:"Analytics",subtitle:"View insights and statistics"},settings:{title:"Settings",subtitle:"Configure extension preferences"},help:{title:"Help",subtitle:"Documentation and troubleshooting"}}[e];t&&(t.textContent=i.title),n&&(n.textContent=i.subtitle)}async loadData(){try{this.currentData=await i.I.getData(),this.filteredResults=[...this.currentData.scrapeResults],this.updateStats(),this.populateFilters(),this.logger.info(`Loaded ${this.currentData.scrapeResults.length} vehicle records`)}catch(e){this.logger.error("Failed to load data:",e),this.showError("Failed to load data")}}updateStats(){if(!this.currentData)return;const e=this.currentData.scrapeResults,t=Date.now(),n=document.getElementById("totalVehicles");n&&(n.textContent=e.length.toString());const i=e.map(e=>e.vehicle.price).filter(e=>e&&e>0),s=i.length>0?i.reduce((e,t)=>e+t,0)/i.length:0,a=document.getElementById("avgPrice");a&&(a.textContent=(0,o.$g)(s));const l=i.reduce((e,t)=>e+t,0),r=document.getElementById("totalValue");r&&(r.textContent=(0,o.$g)(l));const c=e.filter(e=>t-e.scrapedAt<6048e5).length,d=document.getElementById("recentCount");d&&(d.textContent=c.toString())}populateFilters(){if(!this.currentData)return;const e=this.currentData.scrapeResults,t=new Set(e.map(e=>e.vehicle.make).filter(Boolean)),n=document.getElementById("makeFilter");if(n){const e=n.value;n.innerHTML='<option value="">All Makes</option>',Array.from(t).sort().forEach(e=>{const t=document.createElement("option");t.value=e,t.textContent=e,n.appendChild(t)}),n.value=e}const i=new Set(e.map(e=>e.vehicle.year).filter(Boolean)),s=document.getElementById("yearFilter");if(s){const e=s.value;s.innerHTML='<option value="">All Years</option>',Array.from(i).sort((e,t)=>t-e).forEach(e=>{const t=document.createElement("option");t.value=e.toString(),t.textContent=e.toString(),s.appendChild(t)}),s.value=e}}applyFilters(){if(!this.currentData)return;const e=document.getElementById("searchInput"),t=document.getElementById("makeFilter"),n=document.getElementById("yearFilter"),i=document.getElementById("priceFilter"),s=e?.value.toLowerCase()||"",o=t?.value||"",a=n?.value||"",l=i?.value||"";this.filteredResults=this.currentData.scrapeResults.filter(e=>{const t=e.vehicle;if(s&&![t.make,t.model,t.trim,e.dealer.name].filter(Boolean).join(" ").toLowerCase().includes(s))return!1;if(o&&t.make!==o)return!1;if(a&&t.year?.toString()!==a)return!1;if(l&&t.price){const e=t.price;switch(l){case"0-20000":if(e>=2e4)return!1;break;case"20000-40000":if(e<2e4||e>=4e4)return!1;break;case"40000-60000":if(e<4e4||e>=6e4)return!1;break;case"60000+":if(e<6e4)return!1}}return!0}),this.updateInventoryView()}clearFilters(){const e=document.getElementById("searchInput"),t=document.getElementById("makeFilter"),n=document.getElementById("yearFilter"),i=document.getElementById("priceFilter");e&&(e.value=""),t&&(t.value=""),n&&(n.value=""),i&&(i.value=""),this.applyFilters()}updateInventoryView(){const e=document.getElementById("vehicleGrid"),t=document.getElementById("emptyState");if(e&&t){if(0===this.filteredResults.length)return e.innerHTML="",void t.classList.remove("hidden");t.classList.add("hidden"),e.innerHTML="",this.filteredResults.forEach(t=>{const n=this.createVehicleCard(t);e.appendChild(n)})}}createVehicleCard(e){const t=document.createElement("div");t.className="vehicle-card";const n=(0,o.WW)(e.vehicle)||"Unknown Vehicle",i=e.vehicle.price?(0,o.$g)(e.vehicle.price):"Price N/A",s=e.vehicle.mileage?(0,o.M6)(e.vehicle.mileage):"Mileage N/A",a=new Date(e.scrapedAt).toLocaleDateString(),l=new URL(e.sourceUrl).hostname,r=e.photos.find(e=>e.isMain)||e.photos[0],c=r?.url||'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="%23f3f4f6"/><text x="50" y="50" text-anchor="middle" dy=".3em" fill="%236b7280">No Photo</text></svg>';return t.innerHTML=`\n      <div class="vehicle-photo">\n        <img src="${c}" alt="${n}" onerror="this.src='data:image/svg+xml,<svg xmlns=\\"http://www.w3.org/2000/svg\\" width=\\"200\\" height=\\"150\\" viewBox=\\"0 0 200 150\\"><rect width=\\"200\\" height=\\"150\\" fill=\\"%23f3f4f6\\"/><text x=\\"100\\" y=\\"75\\" text-anchor=\\"middle\\" dy=\\".3em\\" fill=\\"%236b7280\\">No Photo</text></svg>'">\n        <div class="photo-count">${e.photos.length} ðŸ“·</div>\n      </div>\n      \n      <div class="vehicle-info">\n        <h3 class="vehicle-title">${n}</h3>\n        \n        <div class="vehicle-details">\n          <div class="detail-row">\n            <span class="detail-label">Price:</span>\n            <span class="detail-value">${i}</span>\n          </div>\n          <div class="detail-row">\n            <span class="detail-label">Mileage:</span>\n            <span class="detail-value">${s}</span>\n          </div>\n          <div class="detail-row">\n            <span class="detail-label">Source:</span>\n            <span class="detail-value">${l}</span>\n          </div>\n          <div class="detail-row">\n            <span class="detail-label">Scraped:</span>\n            <span class="detail-value">${a}</span>\n          </div>\n        </div>\n        \n        <div class="vehicle-actions">\n          <button class="btn btn-sm btn-primary" onclick="optionsManager.openVehicleModal('${e.id}')">\n            View Details\n          </button>\n          <button class="btn btn-sm btn-success" onclick="optionsManager.openInFacebook('${e.id}')">\n            Facebook\n          </button>\n        </div>\n      </div>\n    `,t}updateAnalyticsView(){this.logger.info("Analytics view updated (placeholder)")}updateSettingsView(){if(!this.currentData)return;const e=this.currentData.settings,t=document.getElementById("defaultCondition"),n=document.getElementById("uploadPhotos"),i=document.getElementById("maxPhotos");t&&(t.value=e.autofillOptions.condition||"Used"),n&&(n.checked=!1!==e.autofillOptions.uploadPhotos),i&&(i.value=(e.autofillOptions.maxPhotos||20).toString()),document.querySelectorAll('.site-item input[type="checkbox"]').forEach(t=>{const n=t;n.checked=e.enabledSites.includes(n.value)}),this.updateStorageInfo()}async updateStorageInfo(){try{const e=await i.I.getStorageStats(),t=document.getElementById("storageProgress"),n=document.getElementById("storageText");if(t&&(t.style.width=`${e.percentage}%`),n){const t=Math.round(e.used/1024),i=Math.round(e.total/1048576);n.textContent=`${t} KB of ${i} MB`}}catch(e){this.logger.error("Failed to update storage info:",e)}}async openVehicleModal(e){const t=this.currentData?.scrapeResults.find(t=>t.id===e);if(!t)return;const n=document.getElementById("vehicleModal"),i=document.getElementById("modalTitle"),s=n?.querySelector(".modal-body");if(!n||!s)return;i&&(i.textContent=(0,o.WW)(t.vehicle)||"Vehicle Details"),s.innerHTML=this.createVehicleDetailsHTML(t);const a=document.getElementById("modalFacebookBtn"),l=document.getElementById("modalDownloadBtn"),r=document.getElementById("modalDeleteBtn");a?.replaceWith(a.cloneNode(!0)),l?.replaceWith(l.cloneNode(!0)),r?.replaceWith(r.cloneNode(!0)),document.getElementById("modalFacebookBtn")?.addEventListener("click",()=>{this.openInFacebook(e),this.closeModal()}),document.getElementById("modalDownloadBtn")?.addEventListener("click",()=>{this.downloadPhotos(e)}),document.getElementById("modalDeleteBtn")?.addEventListener("click",()=>{this.deleteVehicle(e),this.closeModal()}),n.classList.remove("hidden")}async openInFacebook(e){const t=this.currentData?.scrapeResults.find(t=>t.id===e);if(t)try{const e=await chrome.runtime.sendMessage({type:"OPEN_FACEBOOK_MARKETPLACE",scrapeResult:t});if(e.error)throw new Error(e.error);s.JV.show("Facebook Marketplace opened!","success")}catch(e){this.logger.error("Failed to open Facebook:",e),this.showError("Failed to open Facebook: "+e.message)}}createVehicleDetailsHTML(e){const{vehicle:t,dealer:n,photos:i}=e;return`\n      <div class="vehicle-details-modal">\n        <div class="details-section">\n          <h4>Vehicle Information</h4>\n          <div class="details-grid">\n            ${t.year?`<div class="detail-item"><strong>Year:</strong> ${t.year}</div>`:""}\n            ${t.make?`<div class="detail-item"><strong>Make:</strong> ${t.make}</div>`:""}\n            ${t.model?`<div class="detail-item"><strong>Model:</strong> ${t.model}</div>`:""}\n            ${t.trim?`<div class="detail-item"><strong>Trim:</strong> ${t.trim}</div>`:""}\n            ${t.price?`<div class="detail-item"><strong>Price:</strong> ${(0,o.$g)(t.price)}</div>`:""}\n            ${t.mileage?`<div class="detail-item"><strong>Mileage:</strong> ${(0,o.M6)(t.mileage)}</div>`:""}\n            ${t.vin?`<div class="detail-item"><strong>VIN:</strong> ${t.vin}</div>`:""}\n            ${t.exteriorColor?`<div class="detail-item"><strong>Exterior Color:</strong> ${t.exteriorColor}</div>`:""}\n            ${t.interiorColor?`<div class="detail-item"><strong>Interior Color:</strong> ${t.interiorColor}</div>`:""}\n            ${t.transmission?`<div class="detail-item"><strong>Transmission:</strong> ${t.transmission}</div>`:""}\n            ${t.drivetrain?`<div class="detail-item"><strong>Drivetrain:</strong> ${t.drivetrain}</div>`:""}\n            ${t.engine?`<div class="detail-item"><strong>Engine:</strong> ${t.engine}</div>`:""}\n            ${t.fuelType?`<div class="detail-item"><strong>Fuel Type:</strong> ${t.fuelType}</div>`:""}\n          </div>\n        </div>\n\n        ${n.name?`\n          <div class="details-section">\n            <h4>Dealer Information</h4>\n            <div class="details-grid">\n              ${n.name?`<div class="detail-item"><strong>Name:</strong> ${n.name}</div>`:""}\n              ${n.phone?`<div class="detail-item"><strong>Phone:</strong> ${n.phone}</div>`:""}\n              ${n.city?`<div class="detail-item"><strong>City:</strong> ${n.city}</div>`:""}\n              ${n.state?`<div class="detail-item"><strong>State:</strong> ${n.state}</div>`:""}\n              ${n.zip?`<div class="detail-item"><strong>ZIP:</strong> ${n.zip}</div>`:""}\n            </div>\n          </div>\n        `:""}\n\n        ${i.length>0?`\n          <div class="details-section">\n            <h4>Photos (${i.length})</h4>\n            <div class="photos-grid">\n              ${i.slice(0,6).map(e=>`\n                <img src="${e.url}" alt="Vehicle photo" class="modal-photo" \n                     onerror="this.style.display='none'">\n              `).join("")}\n              ${i.length>6?`<div class="photos-more">+${i.length-6} more</div>`:""}\n            </div>\n          </div>\n        `:""}\n\n        ${t.description?`\n          <div class="details-section">\n            <h4>Description</h4>\n            <p class="description-text">${t.description}</p>\n          </div>\n        `:""}\n      </div>\n    `}closeModal(){const e=document.getElementById("vehicleModal");e?.classList.add("hidden")}async downloadPhotos(e){const t=this.currentData?.scrapeResults.find(t=>t.id===e);if(t?.photos.length)try{const e=t.photos.map(e=>e.url),n=await chrome.runtime.sendMessage({type:"DOWNLOAD_PHOTOS",photos:e});if(n.error)throw new Error(n.error);s.JV.show(`Downloaded ${n.count} photos`,"success")}catch(e){this.logger.error("Failed to download photos:",e),this.showError("Failed to download photos: "+e.message)}}async deleteVehicle(e){try{await i.I.deleteScrapeResult(e),await this.loadData(),this.updateInventoryView(),s.JV.show("Vehicle deleted","success")}catch(e){this.logger.error("Failed to delete vehicle:",e),this.showError("Failed to delete vehicle")}}async exportData(){try{const e=await i.I.exportData(),t=new Blob([e],{type:"application/json"}),n=URL.createObjectURL(t),o=document.createElement("a");o.href=n,o.download=`vehicle-scraper-data-${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(n),s.JV.show("Data exported successfully","success")}catch(e){this.logger.error("Failed to export data:",e),this.showError("Failed to export data")}}importData(){const e=document.getElementById("importFileInput");e?.click()}async handleFileImport(e){const t=e.target,n=t.files?.[0];if(n){try{const e=await n.text();await i.I.importData(e),await this.loadData(),this.updateInventoryView(),s.JV.show("Data imported successfully","success")}catch(e){this.logger.error("Failed to import data:",e),this.showError("Failed to import data: "+e.message)}t.value=""}}async clearAllData(){if(confirm("Are you sure you want to delete all scraped vehicle data? This cannot be undone."))try{await i.I.clearScrapeResults(),await this.loadData(),this.updateInventoryView(),s.JV.show("All data cleared","success")}catch(e){this.logger.error("Failed to clear data:",e),this.showError("Failed to clear data")}}async saveSettings(){try{const e=document.getElementById("defaultCondition"),t=document.getElementById("uploadPhotos"),n=document.getElementById("maxPhotos"),o=document.querySelectorAll('.site-item input[type="checkbox"]'),a=[];o.forEach(e=>{const t=e;t.checked&&a.push(t.value)});const l={autofillOptions:{condition:e?.value||"Used",uploadPhotos:!1!==t?.checked,maxPhotos:parseInt(n?.value||"20")},enabledSites:a};await i.I.saveSettings(l),s.JV.show("Settings saved successfully","success")}catch(e){this.logger.error("Failed to save settings:",e),this.showError("Failed to save settings")}}async resetSettings(){if(confirm("Reset all settings to defaults?"))try{const e={autofillOptions:{condition:"Used",uploadPhotos:!0,maxPhotos:20},enabledSites:["autotrader.com","cars.com","cargurus.com","dealer.com"]};await i.I.saveSettings(e),this.updateSettingsView(),s.JV.show("Settings reset to defaults","success")}catch(e){this.logger.error("Failed to reset settings:",e),this.showError("Failed to reset settings")}}showError(e){s.JV.show(e,"error")}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{window.optionsManager=new a}):window.optionsManager=new a}},n={};function i(e){var s=n[e];if(void 0!==s)return s.exports;var o=n[e]={exports:{}};return t[e](o,o.exports,i),o.exports}i.m=t,e=[],i.O=(t,n,s,o)=>{if(!n){var a=1/0;for(d=0;d<e.length;d++){for(var[n,s,o]=e[d],l=!0,r=0;r<n.length;r++)(!1&o||a>=o)&&Object.keys(i.O).every(e=>i.O[e](n[r]))?n.splice(r--,1):(l=!1,o<a&&(a=o));if(l){e.splice(d--,1);var c=s();void 0!==c&&(t=c)}}return t}o=o||0;for(var d=e.length;d>0&&e[d-1][2]>o;d--)e[d]=e[d-1];e[d]=[n,s,o]},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={575:0};i.O.j=t=>0===e[t];var t=(t,n)=>{var s,o,[a,l,r]=n,c=0;if(a.some(t=>0!==e[t])){for(s in l)i.o(l,s)&&(i.m[s]=l[s]);if(r)var d=r(i)}for(t&&t(n);c<a.length;c++)o=a[c],i.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return i.O(d)},n=self.webpackChunkworkspace=self.webpackChunkworkspace||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var s=i.O(void 0,[76],()=>i(678));s=i.O(s)})();
//# sourceMappingURL=options.js.map