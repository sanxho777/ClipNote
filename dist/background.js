(()=>{"use strict";var e,r={825:(e,r,t)=>{const a=new(t(265).Vy)("Background");chrome.runtime.onInstalled.addListener(()=>{a.info("Extension installed"),chrome.storage.local.set({scrapeResults:[],settings:{autofillOptions:{condition:"Used",uploadPhotos:!0,maxPhotos:20},enabledSites:["autotrader.com","cars.com","cargurus.com","dealer.com"]}}).catch(e=>{a.error("Failed to initialize storage:",e)})}),chrome.runtime.onMessage.addListener((e,r,t)=>{switch(a.debug("Received message:",e),e.type){case"SCRAPE_PAGE":return async function(e,r){if(e)try{const t=await chrome.scripting.executeScript({target:{tabId:e},func:()=>window.vehicleScraper?.scrape()}),o=t[0]?.result;o?(await async function(e){try{const r=(await chrome.storage.local.get("scrapeResults")).scrapeResults||[];r.unshift(e),r.length>50&&r.splice(50),await chrome.storage.local.set({scrapeResults:r}),a.info("Saved scrape result:",e.id)}catch(e){a.error("Failed to save scrape result:",e)}}(o),r({success:!0,result:o})):r({error:"No data scraped from this page"})}catch(e){a.error("Scrape request failed:",e),r({error:"Failed to scrape page: "+e.message})}else r({error:"No active tab"})}(r.tab?.id,t),!0;case"DOWNLOAD_PHOTOS":return async function(e,r){try{const t=e.map((e,r)=>{const t=`vehicle_photo_${r+1}.jpg`;return chrome.downloads.download({url:e,filename:`vehicle_photos/${t}`,saveAs:!1})});await Promise.all(t),r({success:!0,count:e.length})}catch(e){a.error("Photo download failed:",e),r({error:"Failed to download photos: "+e.message})}}(e.photos,t),!0;case"OPEN_FACEBOOK_MARKETPLACE":return async function(e,r){try{const t="https://www.facebook.com/marketplace/create/vehicle",o=await chrome.tabs.create({url:t});setTimeout(async()=>{if(o.id)try{await chrome.scripting.executeScript({target:{tabId:o.id},func:e=>{window.vehicleAutofillData=e},args:[e]}),r({success:!0,tabId:o.id})}catch(e){a.error("Failed to inject autofill data:",e),r({error:"Failed to prepare autofill data"})}},2e3)}catch(e){a.error("Facebook open failed:",e),r({error:"Failed to open Facebook Marketplace: "+e.message})}}(e.scrapeResult,t),!0;default:return a.warn("Unknown message type:",e.type),!1}}),chrome.tabs.onUpdated.addListener((e,r,t)=>{"complete"===r.status&&t.url&&["autotrader.com","cars.com","cargurus.com","dealer.com"].some(e=>t.url.includes(e))&&chrome.tabs.sendMessage(e,{type:"PAGE_LOADED"}).catch(()=>{})})}},t={};function a(e){var o=t[e];if(void 0!==o)return o.exports;var s=t[e]={exports:{}};return r[e](s,s.exports,a),s.exports}a.m=r,e=[],a.O=(r,t,o,s)=>{if(!t){var c=1/0;for(d=0;d<e.length;d++){for(var[t,o,s]=e[d],i=!0,n=0;n<t.length;n++)(!1&s||c>=s)&&Object.keys(a.O).every(e=>a.O[e](t[n]))?t.splice(n--,1):(i=!1,s<c&&(c=s));if(i){e.splice(d--,1);var l=o();void 0!==l&&(r=l)}}return r}s=s||0;for(var d=e.length;d>0&&e[d-1][2]>s;d--)e[d]=e[d-1];e[d]=[t,o,s]},a.d=(e,r)=>{for(var t in r)a.o(r,t)&&!a.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:r[t]})},a.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),(()=>{var e={471:0};a.O.j=r=>0===e[r];var r=(r,t)=>{var o,s,[c,i,n]=t,l=0;if(c.some(r=>0!==e[r])){for(o in i)a.o(i,o)&&(a.m[o]=i[o]);if(n)var d=n(a)}for(r&&r(t);l<c.length;l++)s=c[l],a.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return a.O(d)},t=self.webpackChunkworkspace=self.webpackChunkworkspace||[];t.forEach(r.bind(null,0)),t.push=r.bind(null,t.push.bind(t))})();var o=a.O(void 0,[76],()=>a(825));o=a.O(o)})();
//# sourceMappingURL=background.js.map